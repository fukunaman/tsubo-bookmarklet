(()=>{const e="tsubo-shared-style";if(!document.getElementById(e)){const t=document.createElement("style");t.id=e,t.textContent=".tb{display:block;margin-top:4px;padding:2px 6px;border-radius:4px;font-weight:600;font-size:.82em;line-height:1.4;background:rgba(255,165,0,.16);color:#b45309}.tb-s{background:rgba(59,130,246,.18);color:#1d4ed8}",document.head.appendChild(t)}const t=3.305785,n=e=>e?e.replace(/\s+/g," ").trim():"",l=e=>{if(!e)return null;const t=e.replace(/\s+/g,"");let n=0;const l=t.match(/([\d.,]+)億/);l&&(n+=1e8*parseFloat(l[1].replace(/,/g,"")));const r=t.match(/([\d.,]+)万/);if(r&&(n+=1e4*parseFloat(r[1].replace(/,/g,""))),!l&&!r){const e=t.replace(/[^\d]/g,"");e&&(n+=parseInt(e,10))}return n||null},r=e=>{if(!e)return null;const n=e.replace(/㎡/g,"m2").replace(/m²/g,"m2");let l=null;const r=n.match(/([\d.,]+)m2/i);r&&(l=parseFloat(r[1].replace(/,/g,"")));let o=null;const c=n.match(/([\d.,]+)\s*坪/);return c&&(o=parseFloat(c[1].replace(/,/g,""))),!o&&l&&(o=l/t),o&&!l&&(l=o*t),o?{sqm:l,tsubo:o}:null},o=(e,t,l)=>{for(const r of e){if(!n(r.textContent).includes(t))continue;let e=l(r);if(e)return{element:e,text:n(e.textContent)}}return null},c=(e,t)=>{const l=Array.isArray(t)?t:[t];for(const t of l){const n=o(e.querySelectorAll("td.category"),t,e=>{let t=e.nextElementSibling;for(;t&&"TD"===t.tagName&&!t.classList.contains("value");)t=t.nextElementSibling;return t});if(n)return n}for(const t of l){const n=o(e.querySelectorAll("dt"),t,e=>{let t=e.nextElementSibling;for(;t&&"DD"!==t.tagName;)t=t.nextElementSibling;return t});if(n)return n}for(const t of l){const n=o(e.querySelectorAll("th"),t,e=>{let t=e.nextElementSibling;for(;t&&"TD"!==t.tagName;)t=t.nextElementSibling;return t});if(n)return n}for(const t of l)for(const l of e.querySelectorAll("span,strong,div,p,dd,td,li")){const e=n(l.textContent);if(e&&e.includes(t))return{element:l,text:e}}return null},s=(e,t,n,l)=>{if(!e)return;let r=e;if(l&&e.closest){const t=e.closest(l);t&&(r=t)}if(r.querySelector&&r.querySelector(":scope > .tb"))return;if(r.style){r.style.whiteSpace="normal";"inline"===getComputedStyle(r).display&&(r.style.display="inline-block")}const o=document.createElement("div");o.className=n,o.textContent=(t>=100?t.toFixed(0):t.toFixed(1))+"万円/坪",r.appendChild(o)},a=({items:e,priceLabels:t,areaLabels:o,className:a,containerSelector:u})=>{if(!e.length)return!1;let i=!1;return e.forEach(e=>{if(e.querySelector(".tb"))return;let d=c(e,t),m=c(e,o);const f=e.querySelector(".bukken-cassette__kakaku"),p=e.querySelector(".bukken-cassette__menseki");!d&&f&&(d={element:f,text:n(f.textContent)}),!m&&p&&(m={element:p,text:n(p.textContent)});const b=l(d&&d.text),y=r(m&&m.text);if(!b||!y)return;const k=b/y.tsubo/1e4,S=d&&d.element||m&&m.element||e;s(S,k,a,u),i=!0}),i},u=({priceNodes:e,areaRoot:t,area:o,className:a})=>{if(!e.length)return!1;let u=o;if(!u){const e=c(t,["専有面積","面積"]);u=r(e&&e.text)}if(!u)return!1;let i=!1;return e.forEach(e=>{if(e.querySelector(".tb"))return;const t=l(n(e.textContent));if(!t)return;const r=t/u.tsubo/1e4;e.style&&(e.style.whiteSpace="normal","inline"===getComputedStyle(e).display&&(e.style.display="inline-block")),s(e,r,a,null),i=!0}),i};a({items:[...document.querySelectorAll("li.item.list-tpl, li.item.smartphone-tpl")],priceLabels:["価格"],areaLabels:["専有面積","面積"],className:"tb",containerSelector:"td.value,dd"}),a({items:[...document.querySelectorAll("#js-bukkenList .property_unit, .bukken-cassette__body")],priceLabels:["販売価格","価格"],areaLabels:["専有面積","面積"],className:"tb tb-s",containerSelector:"dd,td.value,.dottable-value,.property_unit-info,.bukken-cassette__kakaku,.bukken-cassette__menseki"}),u({priceNodes:[...document.querySelectorAll("span.price-area")],areaRoot:document,className:"tb"});const i=[document.querySelector(".futureInfo"),document.querySelector(".detail-sum-table"),document.querySelector(".bukken-detail__table"),document];let d=null;for(const e of i){if(!e)continue;const t=c(e,["専有面積","面積"]);if(t&&r(t.text)){d=e;break}}let m=null;const f=document.querySelector(".futureInfo_menseki_disp");if(m=r(f&&f.textContent),!m&&d){const e=c(d,["専有面積"]);m=r(e&&e.text)}if(!m){const e=c(document,["専有面積"]);m=r(e&&e.text)}if(m){u({priceNodes:[...new Set([...document.querySelectorAll("p.mt7.b"),...document.querySelectorAll(".bukken-detail__price"),...document.querySelectorAll(".bukken-detail__price-value"),...document.querySelectorAll(".futureInfo_list.futureInfo_kakaku")])],areaRoot:d||document,area:m,className:"tb tb-s"})}})();